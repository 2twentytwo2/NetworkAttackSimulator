# Cyber Attack Simulator

A environment for testing AI agents against a simple simulated computer network with subnetworks and machines with different vulnerabilities.

The aim is to retrieve sensitive documents located on certain machines on the network without being caught. Each document provides a large reward to the agent.

The attack terminates in one of the following ways:
1. the agent collects all sensitive documents = goal
2. the agent get caught = loss

The agent receives information about the network topology, specifically:
1. the machines and subnets in the network
2. which machines have the sensitive documents

The agent does not know which services are running on which machine, and hence which machines are vulnerable to which exploits.

The actions available to the agent are exploits and scan.
- exploits:
    - there is one exploit action for each possible service running, which is a envirnment parameter
- scan:
    - reveals which services are present and absent on a target machine (i.e. inspired by Nmap behaviour)

Each action must be launched against a specific machine, but actions will only possibly work on machines that are reachable.

A machine is reachable if:
1. it is on exposed subnet (subnet 1 by default) (i.e. this would be the machines available to public, e.g. webserver)
2. it is on a subnet reachable from a machine on connected subnet that has been successfuly compromised by agent

# Dependencies
- Python >3.5
- Numpy

For rendering:
- matplotlib
- networkX

## Specifying an environment

The environment is defined by:
- number of subnets
- how many machines on each subnet
- the connectivity of each subnet (i.e. which subnets are connected to each other, which are connected to the public internet)
- the possible services running
- the exploits - which service and their success probability

There are two options for generating a new environement:

#### Option 1: autogenerated
Generate an environment automatically based on test environment from literature [Need to add link to paper]

Environment parameters required:
- number of machines
- number of services

The generated network has the following structure:
- Machines distributed across each subnet following a set rule:
    - exposed (subnet 0) - with one machine
    - sensitive (subnet 1) - with one machine
    - user (subnet 2+) - all other machines distributed in tree of subnets with each subnet containing up to 5 machines.

Two machines on network contain Sensitive documents (aka the rewards):
    - One in sensitive subnet machine = r_sensitive
    - One on machine in leaf subnet of user = r_user
    - any machine with no sensitive docs = 0

The configurations of each machine (i.e. which services are present/absent) are allocated randomly but deterministically, so that a network initialized with the same number of machines and services will always produce the same network. This is done to keep consistency for agents trained on a given network size.


e.g. generate an environment with 3 subnets with 3, 4, 5 machines on each and running a possible 3 services with deterministic exploits

```
env = CyberAttackSimulatorEnv([3, 4, 5], 3, deterministic=True)
```

The generated environment will follow a predictable network topology with the first subnet bieng the public subnet accessible from outside and which is connected to the 2nd and 3rd subnets. The 2nd and 3rd subnets are also connected, and any remaining subnets are connected in a tree structure from the 3rd subnet (i.e. think of these as user subnets).

#### Option 2: custom configuration
Generate an environment from a configuration file. The configuration file must be a .yaml file with the following properties:

- subnets: a list of number of machines in each subnet
- topology: an adjacency matrix of connections between each subnet and also the outside world
- services: number of possible services running on any given machine as an integer
- sensitive_machines: a list of lists where each list is of  addresses of machines on network that contain sensitive information that attacker is aiming to access and the value of information on each machine (as float or int)
    - i.e. each list is of form: \[subnetID, machineID, value\]

**Example configuration file:**

The following specifies a network with:
- 5 subnets with 1, 3, 4, 3, 3 machines on each of subnets 0 to 4 respectively, for a total of 14 machines on the network
- The following connectivity:
    - Subnet 0: connected to public and subnets 1 and 2
    - Subnet 1: connected to subnets 0 and 2
    - Subnet 2: connected to subnets 0, 1, 3
    - Subnet 3: connected to subnets 2 and 4
    - Subnet 4: connected to public and subnet 3
- 5 services possibly running on each machine
- Sensitive information on (machines are zero indexed):
    - subnet 2 on machine 2 with value of 1000
    - subnet 3 on machine 0 with value of 500
    - subnet 3 on machine 1 with value of 500

```
subnets: [1, 3, 4, 3, 3]
topology: [[ 1, 1, 1, 1, 0, 0],
                    [ 0, 1, 1, 1, 0, 0],
                    [ 0, 1, 1, 1, 1, 0],
                    [ 0, 0, 0, 1, 1, 1],
                    [ 1, 0, 0, 0, 1, 1]]
services: 5
sensitive_machines: [[2, 2, 1000],
                     [3, 0, 500],
                     [3, 1, 500]]
```


## Other future dev todo
1. Action space class
    1. to allow for random_choice function
    2. optimized data structure?
1. Make it compatible with openAI gym environment

## Ideas for future environment features
1. Attack abort option
    * Agent can choose to abort attack in order to avoid detection
    * Ends episode with agent recieveing only gained rewards
    * Would be a sub-optimal goal
1. Non-deterministic actions
    * exploits may fail with some probability, even when service is present on target machine
1. Each action produces a certain amount of noise which eventually leads to being caught
2. Add support for more than 3 subnets and users to specify depth (i.e. number of subnets to traverse to reach goals)
